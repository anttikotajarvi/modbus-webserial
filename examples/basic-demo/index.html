<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>modbus-webserial / Basic Demo</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; }
  button { padding:.4rem .8rem; margin-right:.6rem; }
  input  { width:4rem; text-align:center; }
  pre    { background:#f7f7f7; padding:.8rem; border:1px solid #ccc; }
</style>
</head>
<body>

<h1>modbus-webserial / Basic Demo</h1>

<button id="btnConnect">ğŸ”Œ Connect</button>
<button id="btnRead"   disabled>ğŸ” Read HR 0â€“1</button>
<button id="btnWrite"  disabled>âœï¸ Write HR 0â€“1</button>

<p>
  Reg 0 <input id="reg0" type="number" value="0">
  Reg 1 <input id="reg1" type="number" value="0">
</p>

<pre id="log"></pre>

<script type="module">
import { ModbusRTU } from "https://unpkg.com/modbus-webserial@latest/dist/index.js";

const log = msg => { document.getElementById("log").textContent += msg + "\n"; };

let client;
const btnConnect = document.getElementById("btnConnect");
const btnRead = document.getElementById("btnRead");
const btnWrite = document.getElementById("btnWrite");
const reg0 = document.getElementById("reg0");
const reg1 = document.getElementById("reg1");

// Connect
btnConnect.onclick = async () => {
  try {
    client = await ModbusRTU.openWebSerial({ baudRate: 9600 });
    client.setID(1);
    log("âœ”ï¸  Connected");
    btnRead.disabled = btnWrite.disabled = false;
  } catch (e) { log("âŒ " + e.message); }
};
// Read registers 0 and 1
btnRead.onclick = async () => {
  try {
    const { data } = await client.readHoldingRegisters(0, 2);
    reg0.value = data[0]; reg1.value = data[1];
    log(`ğŸ“¥  Read  HR0=${data[0]}  HR1=${data[1]}`);
  } catch (e) { log("âŒ " + e.message); }
};
// Write registers 0 and 1
btnWrite.onclick = async () => {
  try {
    const vals = [Number(reg0.value), Number(reg1.value)];
    await client.writeRegisters(0, vals);
    log(`ğŸ“¤  Wrote HR0=${vals[0]}  HR1=${vals[1]}`);
  } catch (e) { log("âŒ " + e.message); }
};
</script>
</body>
</html>
